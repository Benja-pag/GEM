<!-- Pestaña de Reportes -->
<div class="tab-pane fade" id="reportes">
    <style>
        /* Estilos para los botones de colapso de reportes */
        .collapse-toggle-btn {
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
        }
        
        .collapse-toggle-btn:hover {
            background-color: rgba(255, 255, 255, 0.2) !important;
            transform: scale(1.05);
        }
        
        .collapse-toggle-btn i {
            transition: transform 0.3s ease;
        }
        
        .collapse-toggle-btn[aria-expanded="false"] i {
            transform: rotate(180deg);
        }
        
        /* Efecto de desvanecimiento en el colapso */
        .collapse {
            transition: all 0.4s ease;
        }
        
        /* Animación suave para las tarjetas */
        .card {
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        }
        
        /* Estilo especial para headers colapsados */
        .card-header-collapsed {
            border-bottom: none !important;
        }
    </style>
    <div class="row">
        <!-- Panel Principal - Ahora ocupa todo el ancho -->
        <div class="col-12">
            <!-- Reporte de Asistencia de Mis Asignaturas -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-gradient-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-user-check me-2"></i>Reporte de Asistencia - Mis Asignaturas
                    </h5>
                    <button class="btn btn-sm btn-outline-light collapse-toggle-btn" type="button" data-bs-toggle="collapse" 
                            data-bs-target="#collapse-asistencia-asignaturas" aria-expanded="true" 
                            aria-controls="collapse-asistencia-asignaturas" title="Minimizar">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                </div>
                <div class="card-body collapse show" id="collapse-asistencia-asignaturas">
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <p class="text-muted mb-0">
                                <i class="fas fa-info-circle me-2"></i>
                                Reporte de asistencia para todas las asignaturas que impartes
                            </p>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-primary w-100" onclick="generarReporteAsistenciaAsignaturas()">
                                <i class="fas fa-chart-bar me-2"></i>Generar Reporte
                            </button>
                        </div>
                    </div>
                    
                    <!-- Contenedor para el reporte -->
                    <div id="reporte-asistencia-asignaturas" class="mt-3"></div>
                </div>
            </div>

            <!-- Reporte de Asistencia del Curso Jefe -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-gradient-success text-white d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-users me-2"></i>Reporte de Asistencia - Curso Jefe
                    </h5>
                    <button class="btn btn-sm btn-outline-light collapse-toggle-btn" type="button" data-bs-toggle="collapse" 
                            data-bs-target="#collapse-asistencia-curso-jefe" aria-expanded="true" 
                            aria-controls="collapse-asistencia-curso-jefe" title="Minimizar">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                </div>
                <div class="card-body collapse show" id="collapse-asistencia-curso-jefe">
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <p class="text-muted mb-0">
                                <i class="fas fa-info-circle me-2"></i>
                                Reporte de asistencia del curso donde eres profesor jefe
                            </p>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-success w-100" onclick="generarReporteAsistenciaCursoJefe()">
                                <i class="fas fa-chart-bar me-2"></i>Generar Reporte
                            </button>
                        </div>
                    </div>
                    
                    <!-- Contenedor para el reporte -->
                    <div id="reporte-asistencia-curso-jefe" class="mt-3"></div>
                </div>
            </div>

            <!-- Reporte de Evaluaciones de Mis Asignaturas -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-gradient-info text-white d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-clipboard-list me-2"></i>Reporte de Evaluaciones - Mis Asignaturas
                    </h5>
                    <button class="btn btn-sm btn-outline-light collapse-toggle-btn" type="button" data-bs-toggle="collapse" 
                            data-bs-target="#collapse-evaluaciones-asignaturas" aria-expanded="true" 
                            aria-controls="collapse-evaluaciones-asignaturas" title="Minimizar">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                </div>
                <div class="card-body collapse show" id="collapse-evaluaciones-asignaturas">
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <p class="text-muted mb-0">
                                <i class="fas fa-info-circle me-2"></i>
                                Este reporte muestra el rendimiento de todas las asignaturas que impartes
                            </p>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-info w-100" onclick="generarReporteEvaluacionesAsignaturas()">
                                <i class="fas fa-chart-bar me-2"></i>Generar Reporte
                            </button>
                        </div>
                    </div>
                    
                    <!-- Contenedor para el reporte -->
                    <div id="reporte-evaluaciones-asignaturas" class="mt-3"></div>
                </div>
            </div>

            <!-- Reporte de Evaluaciones de Curso Jefe -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-gradient-warning text-dark d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-users me-2"></i>Reporte de Evaluaciones - Curso Jefe
                    </h5>
                    <button class="btn btn-sm btn-outline-dark collapse-toggle-btn" type="button" data-bs-toggle="collapse" 
                            data-bs-target="#collapse-evaluaciones-curso-jefe" aria-expanded="true" 
                            aria-controls="collapse-evaluaciones-curso-jefe" title="Minimizar">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                </div>
                <div class="card-body collapse show" id="collapse-evaluaciones-curso-jefe">
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <p class="text-muted mb-0">
                                <i class="fas fa-info-circle me-2"></i>
                                Este reporte muestra el rendimiento del curso donde eres profesor jefe
                            </p>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-warning w-100" onclick="generarReporteEvaluacionesCursoJefe()">
                                <i class="fas fa-chart-bar me-2"></i>Generar Reporte
                            </button>
                        </div>
                    </div>
                    
                    <!-- Contenedor para el reporte -->
                    <div id="reporte-evaluaciones-curso-jefe" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Función para generar reporte de evaluaciones de las asignaturas del docente
function generarReporteEvaluacionesAsignaturas() {
    const container = document.getElementById('reporte-evaluaciones-asignaturas');
    const btn = event.target;
    
    // Mostrar loading
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generando...';
    
    container.innerHTML = `
        <div class="text-center py-4">
            <i class="fas fa-spinner fa-spin fa-2x text-info mb-3"></i>
            <p class="text-muted">Generando reporte de evaluaciones...</p>
        </div>
    `;
    
    fetch('/api/reporte-evaluaciones-asignaturas-docente/')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                mostrarReporteEvaluacionesAsignaturas(data);
            } else {
                container.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Error: ${data.error || 'No se pudo generar el reporte'}
                    </div>
                `;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            container.innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Error al conectar con el servidor
                </div>
            `;
        })
        .finally(() => {
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-chart-bar me-2"></i>Generar Reporte';
        });
}

// Función para mostrar el reporte de evaluaciones de asignaturas
function mostrarReporteEvaluacionesAsignaturas(data) {
    const container = document.getElementById('reporte-evaluaciones-asignaturas');
    
    if (!data.asignaturas || data.asignaturas.length === 0) {
        container.innerHTML = `
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                No tienes asignaturas asignadas o no hay evaluaciones registradas.
            </div>
        `;
        return;
    }
    
    const stats = data.estadisticas_generales;
    
    container.innerHTML = `
        <!-- Estadísticas Generales -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-info">
                    <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-bar me-2"></i>
                            Mis Asignaturas - Resumen de Evaluaciones
                        </h5>
                        <button type="button" class="btn btn-light btn-sm" onclick="descargarPDFEvaluacionesAsignaturas()">
                            <i class="fas fa-file-pdf me-1"></i>
                            Descargar PDF
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h5 class="text-primary">${stats.total_asignaturas}</h5>
                                        <small class="text-muted">Asignaturas</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h5 class="text-info">${Number.isFinite(Number(stats.total_evaluaciones)) && Number(stats.total_evaluaciones) > 0 ? stats.total_evaluaciones : 'Sin datos'}</h5>
                                        <small class="text-muted">Evaluaciones</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h5 class="text-secondary">${stats.total_notas}</h5>
                                        <small class="text-muted">Notas</small>
                            </div>
                        </div>
                            </div>
                        </div>
                        
                        <div class="table-responsive mt-3">
                            <table class="table table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Asignatura</th>
                                        <th>Código</th>
                                        <th>Cursos</th>
                                        <th>Evaluaciones</th>
                                        <th>Est. Evaluados</th>
                                        <th>Promedio</th>
                                        <th>% Aprobación</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.asignaturas.map(asignatura => `
                                        <tr>
                                            <td><strong>${asignatura.asignatura}</strong></td>
                                            <td><span class="badge bg-secondary">${asignatura.codigo}</span></td>
                                            <td>${asignatura.cursos}</td>
                                            <td><span class="badge bg-info">${asignatura.total_evaluaciones}</span></td>
                                            <td>${asignatura.estudiantes_evaluados}</td>
                                            <td><strong>${asignatura.promedio_asignatura}</strong></td>
                                            <td>
                                                <div class="progress" style="height: 20px;">
                                                    <div class="progress-bar bg-success" role="progressbar" 
                                                         style="width: ${asignatura.porcentaje_aprobacion}%">
                                                        ${asignatura.porcentaje_aprobacion}%
                                                    </div>
                                                </div>
                                            </td>
                                            <td><span class="badge bg-${asignatura.estado_clase}">${asignatura.estado}</span></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// Función para generar reporte de evaluaciones del curso jefe
function generarReporteEvaluacionesCursoJefe() {
    const container = document.getElementById('reporte-evaluaciones-curso-jefe');
    const btn = event.target;
    
    // Mostrar loading
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generando...';
    
    container.innerHTML = `
        <div class="text-center py-4">
            <i class="fas fa-spinner fa-spin fa-2x text-warning mb-3"></i>
            <p class="text-muted">Generando reporte del curso jefe...</p>
        </div>
    `;
    
    fetch('/api/reporte-evaluaciones-curso-jefe/')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                mostrarReporteEvaluacionesCursoJefe(data);
            } else {
                container.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Error: ${data.error || 'No se pudo generar el reporte'}
                    </div>
                `;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            container.innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Error al conectar con el servidor
                </div>
            `;
        })
        .finally(() => {
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-chart-bar me-2"></i>Generar Reporte';
        });
}

// Función para mostrar el reporte de evaluaciones del curso jefe
function mostrarReporteEvaluacionesCursoJefe(data) {
    const container = document.getElementById('reporte-evaluaciones-curso-jefe');
    
    if (!data.asignaturas || data.asignaturas.length === 0) {
        container.innerHTML = `
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                No eres profesor jefe de ningún curso o no hay evaluaciones registradas.
            </div>
        `;
        return;
    }
    
    const stats = data.estadisticas_generales;
    
    container.innerHTML = `
        <!-- Estadísticas Generales del Curso -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-warning">
                    <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-users me-2"></i>
                            Curso ${data.curso} - Evaluaciones por Asignatura
                        </h5>
                        <button type="button" class="btn btn-dark btn-sm" onclick="descargarPDFEvaluacionesCursoJefe()">
                            <i class="fas fa-file-pdf me-1"></i>
                            Descargar PDF
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-2">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h5 class="text-primary">${stats.total_estudiantes}</h5>
                                        <small class="text-muted">Estudiantes</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h5 class="text-info">${stats.total_asignaturas}</h5>
                                        <small class="text-muted">Asignaturas</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="table-responsive mt-3">
                            <table class="table table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Asignatura</th>
                                        <th>Docente</th>
                                        <th>Evaluaciones</th>
                                        <th>Est. Evaluados</th>
                                        <th>Promedio</th>
                                        <th>% Aprobación</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.asignaturas.map(asignatura => `
                                        <tr>
                                            <td><strong>${asignatura.asignatura}</strong></td>
                                            <td>${asignatura.docente}</td>
                                            <td><span class="badge bg-info">${asignatura.total_evaluaciones}</span></td>
                                            <td>${asignatura.estudiantes_evaluados}</td>
                                            <td><strong>${asignatura.promedio_asignatura}</strong></td>
                                            <td>
                                                <div class="progress" style="height: 20px;">
                                                    <div class="progress-bar bg-success" role="progressbar" 
                                                         style="width: ${asignatura.porcentaje_aprobacion}%">
                                                        ${asignatura.porcentaje_aprobacion}%
                                                    </div>
                                                </div>
                                            </td>
                                            <td><span class="badge bg-${asignatura.estado_clase}">${asignatura.estado}</span></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// Función para descargar PDF de evaluaciones de asignaturas
function descargarPDFEvaluacionesAsignaturas() {
    window.open('/pdf/reporte-evaluaciones-asignaturas-docente/', '_blank');
}

// Función para descargar PDF de evaluaciones del curso jefe
function descargarPDFEvaluacionesCursoJefe() {
    window.open('/pdf/reporte-evaluaciones-curso-jefe/', '_blank');
}

// Funciones para Reportes de Asistencia
async function generarReporteAsistenciaAsignaturas() {
    const btnReporte = event.target;
    const contenedor = document.getElementById('reporte-asistencia-asignaturas');
    
    // Mostrar estado de carga
    btnReporte.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generando...';
    btnReporte.disabled = true;
    
    try {
        const response = await fetch('/api/reporte-asistencia-asignaturas-docente/');
        const data = await response.json();
        
        if (data.success) {
            mostrarReporteAsistenciaAsignaturas(data);
        } else {
            contenedor.innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Error: ${data.error || 'No se pudo generar el reporte'}
                </div>
            `;
        }
    } catch (error) {
        console.error('Error:', error);
        contenedor.innerHTML = `
                    <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Error de conexión. Intenta nuevamente.
            </div>
        `;
    } finally {
        // Restaurar botón
        btnReporte.innerHTML = '<i class="fas fa-chart-bar me-2"></i>Generar Reporte';
        btnReporte.disabled = false;
    }
}

function mostrarReporteAsistenciaAsignaturas(data) {
    const contenedor = document.getElementById('reporte-asistencia-asignaturas');
    const stats = data.estadisticas_generales;
    
    let html = `
        <!-- Estadísticas Generales -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body text-center">
                        <h4>${stats.total_asignaturas}</h4>
                        <small>Asignaturas</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body text-center">
                        <h4>${stats.total_clases_programadas}</h4>
                        <small>Clases Programadas</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body text-center">
                        <h4>${stats.porcentaje_asistencia_general}%</h4>
                        <small>Asistencia Promedio</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-white">
                    <div class="card-body text-center">
                        <h4>${stats.total_estudiantes_riesgo}</h4>
                        <small>Estudiantes en Riesgo</small>
                    </div>
                </div>
            </div>
                        </div>
        
        <!-- Botón de descarga PDF -->
        <div class="mb-3">
            <button class="btn btn-danger btn-sm" onclick="descargarPDFAsistenciaAsignaturas()">
                <i class="fas fa-file-pdf me-2"></i>Descargar PDF
            </button>
                        </div>
        
        <!-- Tabla de Asignaturas -->
        <div class="table-responsive">
            <table class="table table-hover table-striped">
                <thead class="table-primary">
                    <tr>
                        <th>Asignatura</th>
                        <th>Código</th>
                        <th>Cursos</th>
                        <th>Clases</th>
                        <th>Registros</th>
                        <th>Presentes</th>
                        <th>% Asistencia</th>
                        <th>En Riesgo</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody>
    `;
    
    data.asignaturas.forEach(asignatura => {
        const porcentajeColor = asignatura.porcentaje_asistencia >= 90 ? 'success' : 
                               asignatura.porcentaje_asistencia >= 80 ? 'info' :
                               asignatura.porcentaje_asistencia >= 70 ? 'warning' : 'danger';
        
        html += `
            <tr>
                <td><strong>${asignatura.asignatura}</strong></td>
                <td><span class="badge bg-secondary">${asignatura.codigo}</span></td>
                <td>${asignatura.cursos}</td>
                <td>${asignatura.total_clases_programadas}</td>
                <td>${asignatura.total_registros_asistencia}</td>
                <td>${asignatura.presentes}</td>
                <td>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar bg-${porcentajeColor}" 
                             style="width: ${asignatura.porcentaje_asistencia}%">
                            ${asignatura.porcentaje_asistencia}%
                        </div>
                    </div>
                </td>
                <td>
                    ${asignatura.estudiantes_en_riesgo > 0 ? 
                        `<span class="badge bg-danger">${asignatura.estudiantes_en_riesgo}</span>` :
                        `<span class="badge bg-success">0</span>`
                    }
                </td>
                <td>
                    <span class="badge bg-${asignatura.estado_clase}">
                        ${asignatura.estado}
                    </span>
                </td>
            </tr>
        `;
    });
    
    html += `
                </tbody>
            </table>
        </div>
    `;
    
    contenedor.innerHTML = html;
}

async function generarReporteAsistenciaCursoJefe() {
    const btnReporte = event.target;
    const contenedor = document.getElementById('reporte-asistencia-curso-jefe');
    
    // Mostrar estado de carga
    btnReporte.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generando...';
    btnReporte.disabled = true;
    
    try {
        const response = await fetch('/api/reporte-asistencia-curso-jefe/');
        const data = await response.json();
        
        if (data.success) {
            mostrarReporteAsistenciaCursoJefe(data);
        } else {
            contenedor.innerHTML = `
                <div class="alert alert-warning">
                    <i class="fas fa-info-circle me-2"></i>
                    ${data.error || 'No eres profesor jefe de ningún curso'}
                </div>
            `;
        }
    } catch (error) {
        console.error('Error:', error);
        contenedor.innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Error de conexión. Intenta nuevamente.
            </div>
        `;
    } finally {
        // Restaurar botón
        btnReporte.innerHTML = '<i class="fas fa-chart-bar me-2"></i>Generar Reporte';
        btnReporte.disabled = false;
    }
}

function mostrarReporteAsistenciaCursoJefe(data) {
    const contenedor = document.getElementById('reporte-asistencia-curso-jefe');
    const stats = data.estadisticas_generales;
    
    let html = `
        <!-- Información del Curso -->
        <div class="alert alert-info">
            <h5><i class="fas fa-graduation-cap me-2"></i>Curso: ${data.curso}</h5>
            <p class="mb-0">Profesor Jefe: ${data.docente}</p>
        </div>
        
        <!-- Estadísticas Generales del Curso -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body text-center">
                        <h4>${stats.total_estudiantes}</h4>
                        <small class="text-muted">Estudiantes</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body text-center">
                        <h4>${stats.total_asignaturas}</h4>
                        <small class="text-muted">Asignaturas</small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Botón de descarga PDF -->
        <div class="mb-3">
            <button class="btn btn-danger btn-sm" onclick="descargarPDFAsistenciaCursoJefe()">
                <i class="fas fa-file-pdf me-2"></i>Descargar PDF
            </button>
        </div>
        
        <!-- Tabla de Asignaturas del Curso -->
        <div class="table-responsive">
            <table class="table table-hover table-striped">
                <thead class="table-success">
                    <tr>
                        <th>Asignatura</th>
                        <th>Código</th>
                        <th>Docente</th>
                        <th>Clases</th>
                        <th>Registros</th>
                        <th>% Asistencia</th>
                        <th>En Riesgo</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody>
    `;
    
    data.asignaturas.forEach(asignatura => {
        const porcentajeColor = asignatura.porcentaje_asistencia >= 90 ? 'success' : 
                               asignatura.porcentaje_asistencia >= 80 ? 'info' :
                               asignatura.porcentaje_asistencia >= 70 ? 'warning' : 'danger';
        
        html += `
            <tr>
                <td><strong>${asignatura.asignatura}</strong></td>
                <td><span class="badge bg-secondary">${asignatura.codigo}</span></td>
                <td>${asignatura.docente}</td>
                <td>${asignatura.total_clases_programadas}</td>
                <td>${asignatura.total_registros_asistencia}</td>
                <td>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar bg-${porcentajeColor}" 
                             style="width: ${asignatura.porcentaje_asistencia}%">
                            ${asignatura.porcentaje_asistencia}%
                        </div>
                    </div>
                </td>
                <td>
                    ${asignatura.estudiantes_en_riesgo > 0 ? 
                        `<span class="badge bg-danger">${asignatura.estudiantes_en_riesgo}</span>` :
                        `<span class="badge bg-success">0</span>`
                    }
                </td>
                <td>
                    <span class="badge bg-${asignatura.estado_clase}">
                        ${asignatura.estado}
                    </span>
                </td>
            </tr>
        `;
    });
    
    html += `
                </tbody>
            </table>
        </div>
    `;
    
    contenedor.innerHTML = html;
}

// Funciones de descarga PDF para asistencia
function descargarPDFAsistenciaAsignaturas() {
    window.open('/pdf/reporte-asistencia-asignaturas-docente/', '_blank');
}

function descargarPDFAsistenciaCursoJefe() {
    window.open('/pdf/reporte-asistencia-curso-jefe/', '_blank');
}

// Función para manejar el cambio de iconos en los botones de colapso
document.addEventListener('DOMContentLoaded', function() {
    // Lista de todos los collapses de reportes
    const collapses = [
        'collapse-asistencia-asignaturas',
        'collapse-asistencia-curso-jefe', 
        'collapse-evaluaciones-asignaturas',
        'collapse-evaluaciones-curso-jefe'
    ];
    
    collapses.forEach(collapseId => {
        const collapseElement = document.getElementById(collapseId);
        const toggleButton = document.querySelector(`[data-bs-target="#${collapseId}"]`);
        
        if (collapseElement && toggleButton) {
            const icon = toggleButton.querySelector('i');
            
            // Evento cuando se está expandiendo
            collapseElement.addEventListener('show.bs.collapse', function() {
                icon.className = 'fas fa-chevron-up';
                toggleButton.setAttribute('title', 'Minimizar');
            });
            
            // Evento cuando se está colapsando
            collapseElement.addEventListener('hide.bs.collapse', function() {
                icon.className = 'fas fa-chevron-down';
                toggleButton.setAttribute('title', 'Expandir');
            });
        }
    });
});

</script> 