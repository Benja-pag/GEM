<!-- Pestaña de Reportes -->
<div class="tab-pane fade" id="reportes" role="tabpanel" aria-labelledby="reportes-tab">
    
    <!-- Dashboard de Métricas Principales -->
    <div class="row mb-4" id="dashboard-metricas">
        <div class="col-md-3">
            <div class="card bg-primary text-white shadow-sm">
                <div class="card-body text-center">
                    <i class="fas fa-users fa-2x mb-2"></i>
                    <h5 class="card-title">Total Estudiantes</h5>
                    <h2 class="display-6" id="total-estudiantes">
                        <div class="spinner-border spinner-border-sm" role="status"></div>
                    </h2>
                    <small>Registrados</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white shadow-sm">
                <div class="card-body text-center">
                    <i class="fas fa-chalkboard-teacher fa-2x mb-2"></i>
                    <h5 class="card-title">Total Docentes</h5>
                    <h2 class="display-6" id="total-docentes">
                        <div class="spinner-border spinner-border-sm" role="status"></div>
                    </h2>
                    <small>Activos</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white shadow-sm">
                <div class="card-body text-center">
                    <i class="fas fa-chart-line fa-2x mb-2"></i>
                    <h5 class="card-title">Promedio General</h5>
                    <h2 class="display-6" id="promedio-general">
                        <div class="spinner-border spinner-border-sm" role="status"></div>
                    </h2>
                    <small>Colegio</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white shadow-sm">
                <div class="card-body text-center">
                    <i class="fas fa-calendar-check fa-2x mb-2"></i>
                    <h5 class="card-title">Asistencia</h5>
                    <h2 class="display-6" id="asistencia-promedio">
                        <div class="spinner-border spinner-border-sm" role="status"></div>
                    </h2>
                    <small>Promedio</small>
                </div>
            </div>
        </div>
    </div>



    <!-- Sistema de Pestañas para Reportes -->
    <div class="container-fluid">
        <ul class="nav nav-tabs mb-4" id="reportesTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="rendimiento-tab" data-bs-toggle="tab" data-bs-target="#rendimiento-academico" type="button" role="tab" aria-controls="rendimiento-academico" aria-selected="true">
                    <i class="fas fa-graduation-cap me-2"></i>Rendimiento Académico
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="asistencia-tab" data-bs-toggle="tab" data-bs-target="#asistencia-reporte" type="button" role="tab" aria-controls="asistencia-reporte" aria-selected="false">
                    <i class="fas fa-calendar-check me-2"></i>Asistencia
                </button>
            </li>

            <li class="nav-item" role="presentation">
                <button class="nav-link" id="riesgo-tab" data-bs-toggle="tab" data-bs-target="#estudiantes-riesgo" type="button" role="tab" aria-controls="estudiantes-riesgo" aria-selected="false">
                    <i class="fas fa-exclamation-triangle me-2"></i>Estudiantes en Riesgo
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="evaluaciones-tab" data-bs-toggle="tab" data-bs-target="#evaluaciones-reporte" type="button" role="tab" aria-controls="evaluaciones-reporte" aria-selected="false">
                    <i class="fas fa-clipboard-list me-2"></i>Evaluaciones
                </button>
            </li>
        </ul>
    </div>

    <!-- Contenido de las Pestañas de Reportes -->
    <div class="tab-content" id="reportesTabContent">
        
        <!-- Pestaña de Rendimiento Académico -->
        <div class="tab-pane fade show active" id="rendimiento-academico" role="tabpanel" aria-labelledby="rendimiento-tab">
            <div class="card shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="card-title mb-0"><i class="fas fa-graduation-cap me-2"></i>Rendimiento Académico por Cursos</h6>
                    <button class="btn btn-sm btn-outline-primary" onclick="generarReporteRendimiento()">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover align-middle" id="tabla-rendimiento-reportes">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-chalkboard"></i> Curso</th>
                                    <th><i class="fas fa-users"></i> Estudiantes</th>
                                    <th><i class="fas fa-clipboard-list"></i> Evaluaciones</th>
                                    <th><i class="fas fa-chart-line"></i> Promedio</th>
                                    <th><i class="fas fa-percentage"></i> Aprobación</th>
                                    <th><i class="fas fa-calendar-check"></i> Asistencia</th>
                                    <th><i class="fas fa-traffic-light"></i> Estado</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-rendimiento">
                                <!-- Las filas se cargarán dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pestaña de Asistencia -->
        <div class="tab-pane fade" id="asistencia-reporte" role="tabpanel" aria-labelledby="asistencia-tab">
            <div class="card shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="card-title mb-0"><i class="fas fa-calendar-check me-2"></i>Reporte de Asistencia por Curso</h6>
                    <button class="btn btn-sm btn-outline-warning" onclick="generarReporteAsistencia()">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                </div>
                <div class="card-body" id="reporte-asistencia">
                    <div class="text-center">
                        <div class="spinner-border text-warning" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <!-- Pestaña de Estudiantes en Riesgo -->
        <div class="tab-pane fade" id="estudiantes-riesgo" role="tabpanel" aria-labelledby="riesgo-tab">
            <div class="card shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="card-title mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Estudiantes en Situación de Riesgo</h6>
                    <button class="btn btn-sm btn-outline-danger" onclick="generarReporteEstudiantesRiesgo()">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                </div>
                <div class="card-body" id="reporte-estudiantes-riesgo">
                    <div class="text-center">
                        <div class="spinner-border text-danger" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pestaña de Evaluaciones -->
        <div class="tab-pane fade" id="evaluaciones-reporte" role="tabpanel" aria-labelledby="evaluaciones-tab">
            <div class="card shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="card-title mb-0"><i class="fas fa-clipboard-list me-2"></i>Reporte de Evaluaciones por Asignatura</h6>
                    <button class="btn btn-sm btn-outline-info" onclick="generarReporteEvaluaciones()">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                </div>
                <div class="card-body" id="reporte-evaluaciones">
                    <div class="text-center">
                        <div class="spinner-border text-info" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
// Variables globales para reportes
let reportesData = {};
let reportesDataTable = null;

// Función para crear filas vacías sin colspan
function crearFilaVacia(numColumnas, contenido, claseAdicional = '') {
    let fila = '<tr>';
    for (let i = 0; i < numColumnas; i++) {
        if (i === 0) {
            fila += `<td class="text-center ${claseAdicional}">${contenido}</td>`;
        } else {
            fila += '<td></td>';
        }
    }
    fila += '</tr>';
    return fila;
}

// Inicializar reportes al cargar la pestaña
function inicializarReportes() {
    // Mostrar spinner inicial en la tabla
    const tbody = document.getElementById('tbody-rendimiento');
    if (tbody) {
        tbody.innerHTML = crearFilaVacia(7, `
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando datos...</span>
            </div>
        `);
    }
    
    cargarDashboardMetricas();
    generarReporteRendimiento();
}

// Cargar métricas del dashboard
function cargarDashboardMetricas() {
    fetch('/api/dashboard-metricas/')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                mostrarDashboardMetricas(data.data);
            } else {
                console.error('Error al cargar métricas:', data.error);
                mostrarErrorMetricas();
            }
        })
        .catch(error => {
            console.error('Error:', error);
            mostrarErrorMetricas();
        });
}

function mostrarDashboardMetricas(data) {
    document.getElementById('total-estudiantes').innerHTML = data.total_estudiantes || '0';
    document.getElementById('total-docentes').innerHTML = data.total_docentes || '0';
    document.getElementById('promedio-general').innerHTML = (data.promedio_general || 0).toFixed(1);
    document.getElementById('asistencia-promedio').innerHTML = (data.asistencia_promedio || 0).toFixed(1) + '%';
}

function mostrarErrorMetricas() {
    document.getElementById('total-estudiantes').innerHTML = '<small class="text-muted">Error</small>';
    document.getElementById('total-docentes').innerHTML = '<small class="text-muted">Error</small>';
    document.getElementById('promedio-general').innerHTML = '<small class="text-muted">Error</small>';
    document.getElementById('asistencia-promedio').innerHTML = '<small class="text-muted">Error</small>';
}

// Generar reporte de rendimiento por cursos
function generarReporteRendimiento() {
    const tbody = document.getElementById('tbody-rendimiento');
    tbody.innerHTML = crearFilaVacia(7, `
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando datos...</span>
        </div>
    `);

    // Destruir DataTable existente si existe
    if (reportesDataTable) {
        reportesDataTable.destroy();
        reportesDataTable = null;
    }

    fetch('/api/reporte-rendimiento-cursos/')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                mostrarTablaRendimiento(data.data);
                reportesData.rendimiento = data.data;
            } else {
                console.error('Error al cargar reporte de rendimiento:', data.error);
                mostrarErrorTabla('tbody-rendimiento', 7);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            mostrarErrorTabla('tbody-rendimiento', 7);
        });
}

function mostrarTablaRendimiento(cursos) {
    const tbody = document.getElementById('tbody-rendimiento');
    
    if (!cursos || cursos.length === 0) {
        tbody.innerHTML = crearFilaVacia(7, 'No hay datos disponibles para el período seleccionado', 'text-muted');
        return;
    }

    tbody.innerHTML = cursos.map(curso => {
        const estadoClass = curso.promedio >= 6.0 ? 'success' : curso.promedio >= 5.0 ? 'warning' : 'danger';
        const estadoTexto = curso.promedio >= 6.0 ? 'Excelente' : curso.promedio >= 5.0 ? 'Regular' : 'Crítico';
        
        return `
            <tr>
                <td><span class="badge bg-primary">${curso.curso}</span></td>
                <td><span class="badge bg-info">${curso.total_estudiantes}</span></td>
                <td><span class="badge bg-secondary">${curso.total_evaluaciones}</span></td>
                <td><strong>${curso.promedio.toFixed(1)}</strong></td>
                <td>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar bg-${estadoClass}" role="progressbar" 
                             style="width: ${curso.porcentaje_aprobacion}%">
                            ${curso.porcentaje_aprobacion.toFixed(1)}%
                        </div>
                    </div>
                </td>
                <td>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar bg-warning" role="progressbar" 
                             style="width: ${curso.asistencia_promedio}%">
                            ${curso.asistencia_promedio.toFixed(1)}%
                        </div>
                    </div>
                </td>
                <td><span class="badge bg-${estadoClass}">${estadoTexto}</span></td>
            </tr>
        `;
    }).join('');

    // Inicializar DataTable después de cargar los datos
    setTimeout(() => {
        try {
            if ($.fn.DataTable && cursos.length > 0) {
                // Verificar que la tabla tenga filas de datos válidas antes de inicializar DataTables
                const tableRows = document.querySelectorAll('#tabla-rendimiento-reportes tbody tr');
                const hasValidData = tableRows.length > 0 && 
                                   !tableRows[0].innerHTML.includes('spinner-border') && 
                                   !tableRows[0].innerHTML.includes('text-muted');
                
                if (hasValidData) {
                    reportesDataTable = $('#tabla-rendimiento-reportes').DataTable({
                        language: {
                            url: '//cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json'
                        },
                        responsive: true,
                        pageLength: 10,
                        order: [[3, 'desc']], // Ordenar por promedio descendente
                        dom: 'Bfrtip',
                        buttons: [
                            'copy', 'csv', 'excel', 'pdf', 'print'
                        ],
                        columnDefs: [
                            { 
                                targets: [4, 5], // Columnas de progreso (Aprobación y Asistencia)
                                orderable: false 
                            }
                        ]
                    });
                }
            }
        } catch (error) {
            console.log('DataTables no disponible o error al inicializar:', error);
        }
    }, 200);
}

// Generar reporte de asistencia
function generarReporteAsistencia() {
    const container = document.getElementById('reporte-asistencia');
    container.innerHTML = `
        <div class="text-center">
            <div class="spinner-border text-warning" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
        </div>
    `;

    fetch('/api/reporte-asistencia-general/')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                mostrarReporteAsistencia(data.data);
            } else {
                console.error('Error al cargar reporte de asistencia:', data.error);
                mostrarErrorReporte('reporte-asistencia');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            mostrarErrorReporte('reporte-asistencia');
        });
}

function mostrarReporteAsistencia(data) {
    const container = document.getElementById('reporte-asistencia');
    
    if (!data || data.length === 0) {
        container.innerHTML = '<p class="text-muted text-center">No hay datos de asistencia disponibles</p>';
        return;
    }

    container.innerHTML = `
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th><i class="fas fa-chalkboard"></i> Curso</th>
                        <th><i class="fas fa-users"></i> Estudiantes</th>
                        <th><i class="fas fa-calendar-check"></i> Asistencia Promedio</th>
                        <th><i class="fas fa-traffic-light"></i> Estado</th>
                    </tr>
                </thead>
                <tbody>
                    ${data.map(item => {
                        const estadoClass = item.asistencia_promedio >= 85 ? 'success' : 
                                          item.asistencia_promedio >= 70 ? 'warning' : 'danger';
                        const estadoTexto = item.asistencia_promedio >= 85 ? 'Excelente' : 
                                          item.asistencia_promedio >= 70 ? 'Regular' : 'Crítica';
                        return `
                            <tr>
                                <td><span class="badge bg-primary">${item.curso}</span></td>
                                <td><span class="badge bg-info">${item.total_estudiantes || 'N/A'}</span></td>
                                <td>
                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar bg-${estadoClass}" 
                                             style="width: ${item.asistencia_promedio}%">
                                            ${item.asistencia_promedio.toFixed(1)}%
                                        </div>
                                    </div>
                                </td>
                                <td><span class="badge bg-${estadoClass}">${estadoTexto}</span></td>
                            </tr>
                        `;
                    }).join('')}
                </tbody>
            </table>
        </div>
    `;
}



// Generar reporte de estudiantes en riesgo
function generarReporteEstudiantesRiesgo() {
    const container = document.getElementById('reporte-estudiantes-riesgo');
    container.innerHTML = `
        <div class="text-center">
            <div class="spinner-border text-danger" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
        </div>
    `;

    fetch('/api/reporte-estudiantes-riesgo/')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                mostrarReporteEstudiantesRiesgo(data.data);
            } else {
                console.error('Error al cargar reporte de estudiantes en riesgo:', data.error);
                mostrarErrorReporte('reporte-estudiantes-riesgo');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            mostrarErrorReporte('reporte-estudiantes-riesgo');
        });
}

function mostrarReporteEstudiantesRiesgo(data) {
    const container = document.getElementById('reporte-estudiantes-riesgo');
    
    if (!data || (!data.riesgo_academico?.length && !data.riesgo_asistencia?.length)) {
        container.innerHTML = `
            <div class="alert alert-success text-center">
                <i class="fas fa-check-circle fa-2x mb-2"></i>
                <h5>¡Excelente!</h5>
                <p class="mb-0">No hay estudiantes en situación de riesgo en este período</p>
            </div>
        `;
        return;
    }

    let html = '<div class="row">';
    
    if (data.riesgo_academico && data.riesgo_academico.length > 0) {
        html += `
            <div class="col-md-6">
                <div class="card border-danger">
                    <div class="card-header bg-danger text-white">
                        <h6 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Riesgo Académico (${data.riesgo_academico.length})</h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Estudiante</th>
                                        <th>Curso</th>
                                        <th>Promedio</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.riesgo_academico.map(est => `
                                        <tr>
                                            <td><small>${est.nombre}</small></td>
                                            <td><span class="badge bg-primary">${est.curso}</span></td>
                                            <td><span class="badge bg-danger">${est.promedio.toFixed(1)}</span></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    if (data.riesgo_asistencia && data.riesgo_asistencia.length > 0) {
        html += `
            <div class="col-md-6">
                <div class="card border-warning">
                    <div class="card-header bg-warning text-dark">
                        <h6 class="mb-0"><i class="fas fa-calendar-times me-2"></i>Riesgo de Asistencia (${data.riesgo_asistencia.length})</h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Estudiante</th>
                                        <th>Curso</th>
                                        <th>Asistencia</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.riesgo_asistencia.map(est => `
                                        <tr>
                                            <td><small>${est.nombre}</small></td>
                                            <td><span class="badge bg-primary">${est.curso}</span></td>
                                            <td><span class="badge bg-warning">${est.asistencia.toFixed(1)}%</span></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    html += '</div>';
    container.innerHTML = html;
}

// Generar reporte de evaluaciones
function generarReporteEvaluaciones() {
    const container = document.getElementById('reporte-evaluaciones');
    container.innerHTML = `
        <div class="text-center">
            <div class="spinner-border text-info" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
        </div>
    `;

    fetch('/api/reporte-evaluaciones/')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                mostrarReporteEvaluaciones(data.data);
            } else {
                console.error('Error al cargar reporte de evaluaciones:', data.error);
                mostrarErrorReporte('reporte-evaluaciones');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            mostrarErrorReporte('reporte-evaluaciones');
        });
}

function mostrarReporteEvaluaciones(data) {
    const container = document.getElementById('reporte-evaluaciones');
    
    if (!data || data.length === 0) {
        container.innerHTML = '<p class="text-muted text-center">No hay datos de evaluaciones disponibles</p>';
        return;
    }

    container.innerHTML = `
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead>
                    <tr>
                        <th><i class="fas fa-book"></i> Asignatura</th>
                        <th><i class="fas fa-clipboard-list"></i> Evaluaciones</th>
                        <th><i class="fas fa-users"></i> Estudiantes Evaluados</th>
                        <th><i class="fas fa-chart-line"></i> Promedio</th>
                        <th><i class="fas fa-percentage"></i> Aprobación</th>
                        <th><i class="fas fa-traffic-light"></i> Estado</th>
                    </tr>
                </thead>
                <tbody>
                    ${data.map(asignatura => {
                        const estadoClass = asignatura.promedio >= 6.0 ? 'success' : 
                                          asignatura.promedio >= 5.0 ? 'warning' : 'danger';
                        const estadoTexto = asignatura.promedio >= 6.0 ? 'Excelente' : 
                                          asignatura.promedio >= 5.0 ? 'Regular' : 'Crítico';
                        return `
                            <tr>
                                <td><strong>${asignatura.asignatura}</strong></td>
                                <td><span class="badge bg-secondary">${asignatura.total_evaluaciones}</span></td>
                                <td><span class="badge bg-info">${asignatura.total_estudiantes || 'N/A'}</span></td>
                                <td><strong>${asignatura.promedio.toFixed(1)}</strong></td>
                                <td>
                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar bg-${estadoClass}" role="progressbar" 
                                             style="width: ${asignatura.porcentaje_aprobacion || 0}%">
                                            ${(asignatura.porcentaje_aprobacion || 0).toFixed(1)}%
                                        </div>
                                    </div>
                                </td>
                                <td><span class="badge bg-${estadoClass}">${estadoTexto}</span></td>
                            </tr>
                        `;
                    }).join('')}
                </tbody>
            </table>
        </div>
    `;
}

// Funciones de utilidad
function mostrarErrorTabla(tbodyId, numColumnas) {
    document.getElementById(tbodyId).innerHTML = crearFilaVacia(numColumnas, 
        '<i class="fas fa-exclamation-triangle me-2"></i>Error al cargar los datos', 
        'text-danger'
    );
}

function mostrarErrorReporte(containerId) {
    document.getElementById(containerId).innerHTML = `
        <div class="text-center text-danger">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <p class="mb-0">Error al cargar el reporte</p>
        </div>
    `;
}

// Actualizar reportes
function actualizarReportes() {
    // Mostrar indicador de carga
    document.querySelectorAll('.spinner-border').forEach(spinner => {
        spinner.style.display = 'inline-block';
    });
    
    // Recargar todos los reportes
    cargarDashboardMetricas();
    
    // Determinar qué pestaña está activa y cargar solo ese reporte
    const activeTab = document.querySelector('#reportesTabs .nav-link.active');
    if (activeTab) {
        const tabId = activeTab.id;
        switch(tabId) {
            case 'rendimiento-tab':
                generarReporteRendimiento();
                break;
            case 'asistencia-tab':
                generarReporteAsistencia();
                break;
            case 'riesgo-tab':
                generarReporteEstudiantesRiesgo();
                break;
            case 'evaluaciones-tab':
                generarReporteEvaluaciones();
                break;
        }
    }
}



// Inicializar reportes cuando se carga la pestaña
document.addEventListener('DOMContentLoaded', function() {
    // Detectar cuando se activa la pestaña de reportes principal
    const reportesTab = document.getElementById('reportes-tab');
    if (reportesTab) {
        reportesTab.addEventListener('shown.bs.tab', function() {
            inicializarReportes();
        });
        
        // Si la pestaña de reportes está activa al cargar la página
        if (reportesTab.classList.contains('active')) {
            inicializarReportes();
        }
    }

    // Detectar cambios en las pestañas internas de reportes
    const reportesInternos = document.querySelectorAll('#reportesTabs .nav-link');
    reportesInternos.forEach(tab => {
        tab.addEventListener('shown.bs.tab', function() {
            const tabId = this.id;
            switch(tabId) {
                case 'rendimiento-tab':
                    generarReporteRendimiento();
                    break;
                case 'asistencia-tab':
                    generarReporteAsistencia();
                    break;
                case 'riesgo-tab':
                    generarReporteEstudiantesRiesgo();
                    break;
                case 'evaluaciones-tab':
                    generarReporteEvaluaciones();
                    break;
            }
        });
    });
});
</script> 