{% extends 'base.html' %}
{% load static %}

{% block extra_js %}
{{ block.super }}
<!-- Scripts específicos -->
<script src="{% static 'js/estudiante_form.js' %}"></script>
<script src="{% static 'js/docente_form.js' %}"></script>
<script src="{% static 'js/user_actions.js' %}"></script>
<script src="{% static 'js/user_edit.js' %}"></script>
<script src="{% static 'js/user_details.js' %}"></script>
<script>
    // Agregar el atributo data-is-admin al body
    document.addEventListener('DOMContentLoaded', function() {
        document.body.setAttribute('data-is-admin', '{% if user.is_admin %}true{% else %}false{% endif %}');
        
        // Hacer las filas de la tabla clickeables
        const rows = document.querySelectorAll('.clickable-row');
        rows.forEach(row => {
            row.addEventListener('click', function(e) {
                // No redirigir si se hizo clic en un botón de acción
                if (!e.target.closest('.btn-group')) {
                    window.location.href = this.dataset.href;
                }
            });
        });

        // Variable global para controlar la inicialización
        window.dataTablesInitialized = false;

        function initializeDataTables() {
            if (window.dataTablesInitialized) {
                return;
            }

            try {
                // Configuración de DataTables
                $.extend(true, $.fn.dataTable.defaults, {
                    pageLength: 10,
                    lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "Todos"]],
                    responsive: true,
                    destroy: true,
                    retrieve: true
                });

                // Inicializar DataTables
                $('.table').each(function() {
                    try {
                        if (!$.fn.DataTable.isDataTable(this)) {
                            $(this).DataTable({
                                language: {
                                    "decimal": "",
                                    "emptyTable": "No hay datos disponibles en la tabla",
                                    "info": "Mostrando _START_ a _END_ de _TOTAL_ registros",
                                    "infoEmpty": "Mostrando 0 a 0 de 0 registros",
                                    "infoFiltered": "(filtrado de _MAX_ registros totales)",
                                    "infoPostFix": "",
                                    "thousands": ",",
                                    "lengthMenu": "Mostrar _MENU_ registros",
                                    "loadingRecords": "Cargando...",
                                    "processing": "Procesando...",
                                    "search": "Buscar:",
                                    "zeroRecords": "No se encontraron registros coincidentes",
                                    "paginate": {
                                        "first": "Primero",
                                        "last": "Último",
                                        "next": "Siguiente",
                                        "previous": "Anterior"
                                    },
                                    "aria": {
                                        "sortAscending": ": activar para ordenar columna ascendente",
                                        "sortDescending": ": activar para ordenar columna descendente"
                                    }
                                }
                            });
                        }
                    } catch (e) {
                        console.warn('Error al inicializar DataTable en una tabla específica:', e);
                    }
                });

                window.dataTablesInitialized = true;
            } catch (e) {
                console.error('Error al inicializar DataTables:', e);
            }
        }

        // Inicializar cuando el documento esté listo
        setTimeout(initializeDataTables, 100);

        // Reinicializar después de cargar contenido dinámico
        $(document).ajaxComplete(function() {
            setTimeout(initializeDataTables, 100);
        });
    });
</script>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin_panel.css' %}">
<link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
{% csrf_token %}
{% if user.is_authenticated %}
<div class="container-fluid">
    <!-- Contenedor de alertas -->
    <div id="alertContainer" class="position-fixed top-0 end-0 p-3" style="z-index: 1050"></div>
    
    <div class="row">
        <!-- Sidebar -->
        <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-primary sidebar">
            <div class="position-sticky">
                <div class="text-center py-4" style="margin-left: -15px;">
                    <img src="{% static 'img/logo.png' %}" alt="Logo GEM" class="img-fluid mb-3" style="max-width: 250px; height: auto; object-fit: contain;">
                    <h5 class="text-white">Panel de Control</h5>
                </div>
                <ul class="nav flex-column">
                    {% if user.is_admin %}
                    <li class="nav-item">
                        <a class="nav-link active text-white" href="#usuarios">
                            <i class="fas fa-users me-2"></i> Usuarios
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="#cursos">
                            <i class="fas fa-book me-2"></i> Cursos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="#estadisticas">
                            <i class="fas fa-chart-bar me-2"></i> Estadísticas
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </nav>

        <!-- Contenido Principal -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <!-- Barra Superior -->
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <div>
                    <h2 class="h3">Bienvenido {{ user.usuario.nombre }} {{ user.usuario.apellido_paterno }} {{ user.usuario.apellido_materno }}</h2>
                    <p class="text-muted">
                        {% if user.is_admin %}
                            Administrador
                        {% endif %}
                    </p>
                </div>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <form method="post" action="{% url 'logout' %}" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-outline-danger">
                            <i class="fas fa-sign-out-alt me-2"></i> Cerrar Sesión
                        </button>
                    </form>
                </div>
            </div>

            {% if user.is_admin %}
            <!-- Estadísticas -->
            <div class="row mb-4">
                <div class="col-md-2">
                    <div class="card bg-primary text-white">
                        <div class="card-body">
                            <h5 class="card-title">Total Estudiantes</h5>
                            <p class="card-text display-4 text-white">{{ total_estudiantes }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="card bg-success text-white">
                        <div class="card-body">
                            <h5 class="card-title">Total Profesores</h5>
                            <p class="card-text display-4 text-white">{{ total_profesores }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="card bg-info text-white">
                        <div class="card-body">
                            <h5 class="card-title">Total Clases</h5>
                            <p class="card-text display-4 text-white">{{ total_clases }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="card bg-warning text-white">
                        <div class="card-body">
                            <h5 class="card-title">Total Asignaturas</h5>
                            <p class="card-text display-4 text-white">{{ total_asignaturas }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="card bg-danger text-white">
                        <div class="card-body">
                            <h5 class="card-title">Total Administradores</h5>
                            <p class="card-text display-4 text-white">{{ total_administradores }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Botones de Creación -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#crearEstudianteModal">
                            <i class="fas fa-user-graduate me-2"></i> Crear Estudiante
                        </button>
                        <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#crearDocenteModal">
                            <i class="fas fa-chalkboard-teacher me-2"></i> Crear Profesor
                        </button>
                        <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#crearAdminModal">
                            <i class="fas fa-user-shield me-2"></i> Crear Administrador
                        </button>
                        <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#crearCursoModal">
                            <i class="fas fa-chalkboard me-2"></i> Crear Curso
                        </button>
                        <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#crearAsignaturaModal">
                            <i class="fas fa-book me-2"></i> Crear Asignatura
                        </button>
                    </div>
                </div>
            </div>

            <!-- Modal de Creación de Estudiante -->
            <div class="modal fade" id="crearEstudianteModal" tabindex="-1" aria-labelledby="crearEstudianteModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="crearEstudianteModalLabel">Crear Nuevo Estudiante</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="crearEstudianteForm" method="post" class="needs-validation" novalidate>
                                {% csrf_token %}
                                <input type="hidden" name="action" value="crear_estudiante">
                                
                                <!-- Alertas de error -->
                                <div class="alert alert-danger" id="errorAlertEstudiante" style="display: none;">
                                    <ul id="errorListEstudiante"></ul>
                                </div>

                                <!-- Información Personal -->
                                <h6 class="mb-3">Información Personal</h6>
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label for="estudiante_nombre" class="form-label">Nombre</label>
                                        <input type="text" class="form-control" id="estudiante_nombre" name="nombre" required 
                                               pattern="[A-Za-záéíóúÁÉÍÓÚñÑ\s]+" title="Solo letras y espacios permitidos">
                                        <div class="invalid-feedback">
                                            Por favor ingrese un nombre válido
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="estudiante_apellido_paterno" class="form-label">Apellido Paterno</label>
                                        <input type="text" class="form-control" id="estudiante_apellido_paterno" name="apellido_paterno" required
                                               pattern="[A-Za-záéíóúÁÉÍÓÚñÑ\s]+" title="Solo letras y espacios permitidos">
                                        <div class="invalid-feedback">
                                            Por favor ingrese un apellido paterno válido
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="estudiante_apellido_materno" class="form-label">Apellido Materno</label>
                                        <input type="text" class="form-control" id="estudiante_apellido_materno" name="apellido_materno" required
                                               pattern="[A-Za-záéíóúÁÉÍÓÚñÑ\s]+" title="Solo letras y espacios permitidos">
                                        <div class="invalid-feedback">
                                            Por favor ingrese un apellido materno válido
                                        </div>
                                    </div>
                                </div>

                                <!-- RUT y DV -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="estudiante_rut" class="form-label">RUT (sin puntos ni guión)</label>
                                        <input type="text" class="form-control" id="estudiante_rut" name="rut" required
                                               pattern="[0-9]{7,8}" title="7 u 8 dígitos sin puntos ni guión">
                                        <div class="invalid-feedback">
                                            Por favor ingrese un RUT válido (7 u 8 dígitos)
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="estudiante_div" class="form-label">Dígito Verificador</label>
                                        <input type="text" class="form-control" id="estudiante_div" name="div" maxlength="1" required
                                               pattern="[0-9Kk]" title="Número del 0 al 9 o letra K">
                                        <div class="invalid-feedback">
                                            DV inválido (0-9 o K)
                                        </div>
                                    </div>
                                </div>

                                <!-- Contacto -->
                                <h6 class="mb-3">Información de Contacto</h6>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="estudiante_correo" class="form-label">Correo Electrónico</label>
                                        <input type="email" class="form-control" id="estudiante_correo" name="correo" required>
                                        <div class="invalid-feedback">
                                            Por favor ingrese un correo electrónico válido
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="estudiante_telefono" class="form-label">Teléfono</label>
                                        <input type="tel" class="form-control" id="estudiante_telefono" name="telefono" required
                                               pattern="[0-9]{9}" title="9 dígitos">
                                        <div class="invalid-feedback">
                                            Por favor ingrese un número de teléfono válido (9 dígitos)
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="estudiante_direccion" class="form-label">Dirección</label>
                                    <textarea class="form-control" id="estudiante_direccion" name="direccion" rows="2" required></textarea>
                                    <div class="invalid-feedback">
                                        Por favor ingrese una dirección
                                    </div>
                                </div>

                                <!-- Información Académica -->
                                <h6 class="mb-3">Información Académica</h6>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="estudiante_fecha_nacimiento" class="form-label">Fecha de Nacimiento</label>
                                        <input type="date" class="form-control" id="estudiante_fecha_nacimiento" name="fecha_nacimiento" required>
                                        <div class="invalid-feedback">
                                            Por favor seleccione una fecha de nacimiento
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="estudiante_curso" class="form-label">Curso</label>
                                        <select class="form-select" id="estudiante_curso" name="curso" required>
                                            <option value="">Seleccione un curso</option>
                                            {% for curso in cursos %}
                                                <option value="{{ curso.id }}">{{ curso }}</option>
                                            {% endfor %}
                                        </select>
                                        <div class="invalid-feedback">
                                            Por favor seleccione un curso
                                        </div>
                                    </div>
                                </div>

                                <!-- Contacto de Emergencia -->
                                <h6 class="mb-3">Contacto de Emergencia</h6>
                                <div class="mb-3">
                                    <label for="estudiante_contacto_emergencia" class="form-label">Nombre y Teléfono de Contacto</label>
                                    <input type="text" class="form-control" id="estudiante_contacto_emergencia" 
                                           name="contacto_emergencia" required
                                           placeholder="Ej: María (Madre) - 912345678">
                                    <div class="invalid-feedback">
                                        Por favor ingrese un contacto de emergencia
                                    </div>
                                </div>

                                <!-- Contraseña -->
                                <h6 class="mb-3">Credenciales de Acceso</h6>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="estudiante_password" class="form-label">Contraseña</label>
                                        <input type="password" class="form-control" id="estudiante_password" name="password" required
                                               pattern=".{8,}" title="Mínimo 8 caracteres">
                                        <div class="invalid-feedback">
                                            La contraseña debe tener al menos 8 caracteres
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="estudiante_confirm_password" class="form-label">Confirmar Contraseña</label>
                                        <input type="password" class="form-control" id="estudiante_confirm_password" 
                                               name="confirm_password" required>
                                        <div class="invalid-feedback">
                                            Las contraseñas no coinciden
                                        </div>
                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">Crear Estudiante</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal de Creación de Docente -->
            <div class="modal fade" id="crearDocenteModal" tabindex="-1" aria-labelledby="crearDocenteModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="crearDocenteModalLabel">Crear Nuevo Docente</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="crearDocenteForm" method="post" class="needs-validation" novalidate>
                                {% csrf_token %}
                                <input type="hidden" name="action" value="crear_docente">
                                
                                <!-- Alertas de error -->
                                <div class="alert alert-danger" id="errorAlertDocente" style="display: none;">
                                    <ul id="errorListDocente"></ul>
                                </div>

                                <!-- Información Personal -->
                                <h6 class="mb-3">Información Personal</h6>
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label for="docente_nombre" class="form-label">Nombre</label>
                                        <input type="text" class="form-control" id="docente_nombre" name="nombre" required 
                                               pattern="[A-Za-záéíóúÁÉÍÓÚñÑ\s]+" title="Solo letras y espacios permitidos">
                                        <div class="invalid-feedback">
                                            Por favor ingrese un nombre válido
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="docente_apellido_paterno" class="form-label">Apellido Paterno</label>
                                        <input type="text" class="form-control" id="docente_apellido_paterno" name="apellido_paterno" required
                                               pattern="[A-Za-záéíóúÁÉÍÓÚñÑ\s]+" title="Solo letras y espacios permitidos">
                                        <div class="invalid-feedback">
                                            Por favor ingrese un apellido paterno válido
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="docente_apellido_materno" class="form-label">Apellido Materno</label>
                                        <input type="text" class="form-control" id="docente_apellido_materno" name="apellido_materno" required
                                               pattern="[A-Za-záéíóúÁÉÍÓÚñÑ\s]+" title="Solo letras y espacios permitidos">
                                        <div class="invalid-feedback">
                                            Por favor ingrese un apellido materno válido
                                        </div>
                                    </div>
                                </div>

                                <!-- RUT y DV -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="docente_rut" class="form-label">RUT (sin puntos ni guión)</label>
                                        <input type="text" class="form-control" id="docente_rut" name="rut" required
                                               pattern="[0-9]{7,8}" title="7 u 8 dígitos sin puntos ni guión">
                                        <div class="invalid-feedback">
                                            Por favor ingrese un RUT válido (7 u 8 dígitos)
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="docente_div" class="form-label">Dígito Verificador</label>
                                        <input type="text" class="form-control" id="docente_div" name="div" maxlength="1" required
                                               pattern="[0-9Kk]" title="Número del 0 al 9 o letra K">
                                        <div class="invalid-feedback">
                                            DV inválido (0-9 o K)
                                        </div>
                                    </div>
                                </div>

                                <!-- Contacto -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="docente_correo" class="form-label">Correo Electrónico</label>
                                        <input type="email" class="form-control" id="docente_correo" name="correo" required
                                               pattern="[a-zA-Z0-9._%+-]+@gem\.cl$" title="Debe ser un correo @gem.cl">
                                        <div class="invalid-feedback">
                                            Debe ser un correo institucional (@gem.cl)
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="docente_telefono" class="form-label">Teléfono</label>
                                        <input type="tel" class="form-control" id="docente_telefono" name="telefono" required
                                               pattern="[0-9]{9}" title="9 dígitos numéricos">
                                        <div class="invalid-feedback">
                                            Ingrese un número válido de 9 dígitos
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="docente_direccion" class="form-label">Dirección</label>
                                    <textarea class="form-control" id="docente_direccion" name="direccion" rows="2" required></textarea>
                                    <div class="invalid-feedback">
                                        Por favor ingrese una dirección
                                    </div>
                                </div>

                                <!-- Información Académica -->
                                <h6 class="mb-3">Información Académica</h6>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="docente_fecha_nacimiento" class="form-label">Fecha de Nacimiento</label>
                                        <input type="date" class="form-control" id="docente_fecha_nacimiento" name="fecha_nacimiento" required>
                                        <div class="invalid-feedback">
                                            Debe ser mayor de 21 años
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="docente_especialidad" class="form-label">Especialidad</label>
                                        <select class="form-select" id="docente_especialidad" name="especialidad" required>
                                            <option value="">Seleccione una especialidad</option>
                                            {% for especialidad in especialidades %}
                                                <option value="{{ especialidad.id }}">{{ especialidad.nombre }}</option>
                                            {% endfor %}
                                        </select>
                                        <div class="invalid-feedback">
                                            Por favor seleccione una especialidad
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="docente_es_profesor_jefe" name="es_profesor_jefe">
                                        <label class="form-check-label" for="docente_es_profesor_jefe">
                                            Es Profesor Jefe
                                        </label>
                                    </div>
                                </div>

                                <!-- Contraseña -->
                                <h6 class="mb-3">Credenciales de Acceso</h6>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="docente_password" class="form-label">Contraseña</label>
                                        <input type="password" class="form-control" id="docente_password" name="password" required
                                               minlength="8" title="Mínimo 8 caracteres">
                                        <div class="invalid-feedback">
                                            La contraseña debe tener al menos 8 caracteres
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="docente_confirm_password" class="form-label">Confirmar Contraseña</label>
                                        <input type="password" class="form-control" id="docente_confirm_password" 
                                               name="confirm_password" required>
                                        <div class="invalid-feedback">
                                            Las contraseñas no coinciden
                                        </div>
                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="submit" class="btn btn-success">Crear Docente</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal de Creación de Administrador -->
            <div class="modal fade" id="crearAdminModal" tabindex="-1" aria-labelledby="crearAdminModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="crearAdminModalLabel">Crear Nuevo Administrador</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="crearAdminForm" method="post" action="{% url 'admin_panel' %}" class="needs-validation" novalidate>
                                {% csrf_token %}
                                <input type="hidden" name="action" value="crear_administrador">
                                
                                <!-- Alertas de error -->
                                <div class="alert alert-danger" id="errorAlertAdmin" style="display: none;">
                                    <ul id="errorListAdmin"></ul>
                                </div>

                                <!-- Información Personal -->
                                <h6 class="mb-3">Información Personal</h6>
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label for="admin_nombre" class="form-label">Nombre</label>
                                        <input type="text" class="form-control" id="admin_nombre" name="nombre" required 
                                               pattern="[A-Za-záéíóúÁÉÍÓÚñÑ\s]+" title="Solo letras y espacios permitidos">
                                        <div class="invalid-feedback">
                                            Por favor ingrese un nombre válido
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="admin_apellido_paterno" class="form-label">Apellido Paterno</label>
                                        <input type="text" class="form-control" id="admin_apellido_paterno" name="apellido_paterno" required
                                               pattern="[A-Za-záéíóúÁÉÍÓÚñÑ\s]+" title="Solo letras y espacios permitidos">
                                        <div class="invalid-feedback">
                                            Por favor ingrese un apellido paterno válido
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="admin_apellido_materno" class="form-label">Apellido Materno</label>
                                        <input type="text" class="form-control" id="admin_apellido_materno" name="apellido_materno" required
                                               pattern="[A-Za-záéíóúÁÉÍÓÚñÑ\s]+" title="Solo letras y espacios permitidos">
                                        <div class="invalid-feedback">
                                            Por favor ingrese un apellido materno válido
                                        </div>
                                    </div>
                                </div>

                                <!-- RUT y DV -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="admin_rut" class="form-label">RUT (sin puntos ni guión)</label>
                                        <input type="text" class="form-control" id="admin_rut" name="rut" required
                                               pattern="[0-9]{7,8}" title="7 u 8 dígitos sin puntos ni guión">
                                        <div class="invalid-feedback">
                                            Por favor ingrese un RUT válido (7 u 8 dígitos)
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="admin_div" class="form-label">Dígito Verificador</label>
                                        <input type="text" class="form-control" id="admin_div" name="div" maxlength="1" required
                                               pattern="[0-9Kk]" title="Número del 0 al 9 o letra K">
                                        <div class="invalid-feedback">
                                            DV inválido (0-9 o K)
                                        </div>
                                    </div>
                                </div>

                                <!-- Contacto -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="admin_correo" class="form-label">Correo Electrónico</label>
                                        <input type="email" class="form-control" id="admin_correo" name="correo" required
                                               pattern="[a-zA-Z0-9._%+-]+@gem\.cl$" title="Debe ser un correo @gem.cl">
                                        <div class="invalid-feedback">
                                            Debe ser un correo institucional (@gem.cl)
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="admin_telefono" class="form-label">Teléfono</label>
                                        <input type="tel" class="form-control" id="admin_telefono" name="telefono" required
                                               pattern="[0-9]{9}" title="9 dígitos numéricos">
                                        <div class="invalid-feedback">
                                            Ingrese un número válido de 9 dígitos
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="admin_direccion" class="form-label">Dirección</label>
                                    <textarea class="form-control" id="admin_direccion" name="direccion" rows="2" required></textarea>
                                    <div class="invalid-feedback">
                                        Por favor ingrese una dirección
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="admin_fecha_nacimiento" class="form-label">Fecha de Nacimiento</label>
                                    <input type="date" class="form-control" id="admin_fecha_nacimiento" name="fecha_nacimiento" required>
                                    <div class="invalid-feedback">
                                        Debe ser mayor de 21 años
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="admin_password" class="form-label">Contraseña</label>
                                        <input type="password" class="form-control" id="admin_password" name="password" required
                                               minlength="8" title="Mínimo 8 caracteres">
                                        <div class="invalid-feedback">
                                            La contraseña debe tener al menos 8 caracteres
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="admin_confirm_password" class="form-label">Confirmar Contraseña</label>
                                        <input type="password" class="form-control" id="admin_confirm_password" name="confirm_password" required>
                                        <div class="invalid-feedback">
                                            Las contraseñas deben coincidir
                                        </div>
                                    </div>
                                </div>

                                <!-- Campos específicos para administrativos -->
                                <h6 class="mb-3">Información Administrativa</h6>
                                <div class="mb-3">
                                    <label for="admin_rol" class="form-label">Rol Administrativo</label>
                                    <select class="form-select" id="admin_rol" name="rol" required>
                                        <option value="">Seleccione un rol</option>
                                        <option value="ADMINISTRADOR">Administrador Máximo</option>
                                        <option value="ADMINISTRATIVO">Administrativo</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Por favor seleccione un rol administrativo
                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">Crear Administrador</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Crear Curso -->
            <div class="modal fade" id="crearCursoModal" tabindex="-1" aria-labelledby="crearCursoModalLabel" aria-hidden="true" data-bs-backdrop="static">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="crearCursoModalLabel">Crear Nuevo Curso</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="crearCursoForm" method="post" action="{% url 'admin_panel' %}">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="crear_curso">
                                
                                <!-- Contenedor de errores -->
                                <div class="alert alert-danger mb-3" style="display: none;"></div>
                                
                                <div class="mb-3">
                                    <label for="nivel" class="form-label">Nivel</label>
                                    <input type="number" class="form-control" id="nivel" name="nivel" min="1" max="12" required>
                                    <div class="invalid-feedback"></div>
                                </div>
                                <div class="mb-3">
                                    <label for="letra" class="form-label">Letra</label>
                                    <input type="text" class="form-control" id="letra" name="letra" maxlength="1" required>
                                    <div class="invalid-feedback"></div>
                                </div>
                                <div class="mb-3">
                                    <label for="profesor_jefe_id" class="form-label">Profesor Jefe</label>
                                    <select class="form-select" id="profesor_jefe_id" name="profesor_jefe_id" required>
                                        <option value="">-- Seleccione un profesor jefe --</option>
                                        {% for docente in docentes %}
                                            {% if docente.usuario and docente.usuario.id %}
                                                <option value="{{ docente.usuario.id }}" data-nombre="{{ docente.usuario.nombre }} {{ docente.usuario.apellido_paterno }}">
                                                    {{ docente.usuario.nombre }} {{ docente.usuario.apellido_paterno }}
                                                </option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                    <div class="invalid-feedback">Por favor seleccione un profesor jefe</div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="submit" class="btn btn-primary" id="crearCursoBtn">Crear</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal de Creación de Asignatura -->
            <div class="modal fade" id="crearAsignaturaModal" tabindex="-1" aria-labelledby="crearAsignaturaModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="crearAsignaturaModalLabel">Crear Nueva Asignatura</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form method="post" action="{% url 'admin_panel' %}">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="crear_asignatura">
                                
                                <div class="mb-3">
                                    <label for="nombre" class="form-label">Nombre de la Asignatura</label>
                                    <input type="text" class="form-control" id="nombre" name="nombre" required>
                                </div>

                                <div class="mb-3">
                                    <label for="asignatura_nivel" class="form-label">Nivel</label>
                                    <select class="form-select" id="asignatura_nivel" name="nivel" required>
                                        <option value="">Seleccione un nivel</option>
                                        <option value="1">1°</option>
                                        <option value="2">2°</option>
                                        <option value="3">3°</option>
                                        <option value="4">4°</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label for="docente" class="form-label">Profesor</label>
                                    <select class="form-select" id="docente" name="docente" required>
                                        <option value="">Seleccione un profesor</option>
                                        {% for profesor in profesores %}
                                        <option value="{{ profesor.id }}">{{ profesor.usuario.nombre }} {{ profesor.usuario.apellido_paterno }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Día y Horario</label>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <select class="form-select mb-2" id="dia" name="dia" required>
                                                <option value="">Seleccione un día</option>
                                                <option value="LUNES">Lunes</option>
                                                <option value="MARTES">Martes</option>
                                                <option value="MIERCOLES">Miércoles</option>
                                                <option value="JUEVES">Jueves</option>
                                                <option value="VIERNES">Viernes</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <select class="form-select mb-2" id="bloque" name="bloque" required>
                                                <option value="">Seleccione un horario</option>
                                                <option value="1">08:00 - 09:30</option>
                                                <option value="2">09:30 - 11:00</option>
                                                <option value="RECREO1">11:00 - 11:30 (Recreo)</option>
                                                <option value="3">11:30 - 13:00</option>
                                                <option value="4">13:00 - 14:30</option>
                                                <option value="RECREO2">14:30 - 15:00 (Recreo)</option>
                                                <option value="5">15:00 - 16:30</option>
                                                {% if not es_viernes %}
                                                <option value="6">16:30 - 18:00</option>
                                                {% endif %}
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="sala" class="form-label">Sala</label>
                                    <select class="form-select" id="sala" name="sala" required>
                                        <option value="">Seleccione una sala</option>
                                        <option value="SALA_1">Sala 1</option>
                                        <option value="SALA_2">Sala 2</option>
                                        <option value="SALA_3">Sala 3</option>
                                        <option value="SALA_4">Sala 4</option>
                                        <option value="SALA_5">Sala 5</option>
                                        <option value="SALA_6">Sala 6</option>
                                        <option value="SALA_7">Sala 7</option>
                                        <option value="SALA_8">Sala 8</option>
                                        <option value="LABORATORIO">Laboratorio</option>
                                        <option value="GIMNASIO">Gimnasio</option>
                                        <option value="BIBLIOTECA">Biblioteca</option>
                                        <option value="AUDITORIO">Auditorio</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="es_electivo" name="es_electivo">
                                        <label class="form-check-label" for="es_electivo">
                                            Es Electivo
                                        </label>
                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">Crear Asignatura</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lista de Usuarios Recientes -->
            <div class="container-fluid mb-2">
                <h5 class="mb-3">Usuarios Recientes</h5>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>RUT</th>
                                <th>Nombre</th>
                                <th>Correo</th>
                                <th>Tipo</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for usuario in usuarios %}
                            <tr>
                                <td>{{ usuario.rut }}-{{ usuario.div }}</td>
                                <td>{{ usuario.nombre }} {{ usuario.apellido_paterno }} {{ usuario.apellido_materno }}</td>
                                <td>{{ usuario.correo }}</td>
                                <td>
                                    {% if usuario.administrativo %}
                                        {{ usuario.administrativo.get_rol_display }}
                                    {% elif usuario.docente %}
                                        Docente
                                    {% elif usuario.estudiante %}
                                        Estudiante
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge {% if usuario.activador %}bg-success{% else %}bg-danger{% endif %}">
                                        {% if usuario.activador %}Activo{% else %}Inactivo{% endif %}
                                    </span>
                                </td>
                                <td>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-info btn-sm view-user" data-user-id="{{ usuario.auth_user_id }}" title="Ver detalles">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button type="button" class="btn btn-warning btn-sm edit-user" data-user-id="{{ usuario.auth_user_id }}" title="Editar">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm toggle-user-status {% if usuario.activador %}btn-success{% else %}btn-danger{% endif %}" 
                                                data-user-id="{{ usuario.auth_user_id }}" 
                                                data-is-active="{{ usuario.activador|lower }}"
                                                title="{% if usuario.activador %}Desactivar{% else %}Activar{% endif %}">
                                            <i class="fas {% if usuario.activador %}fa-user-check{% else %}fa-user-slash{% endif %}"></i>
                                        </button>
                                        <button class="btn btn-danger btn-sm delete-user" data-user-id="{{ usuario.auth_user_id }}" title="Eliminar">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center">No hay usuarios registrados</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Cursos Activos -->
            <div class="container-fluid mb-2">
                <h5 class="mb-3">Cursos Activos</h5>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Curso</th>
                                <th>Profesor Jefe</th>
                                <th>Estudiantes</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for curso in cursos %}
                            <tr>
                                <td>{{ curso.nivel }}°{{ curso.letra }}</td>
                                <td>
                                    {% if curso.jefatura_actual %}
                                        {{ curso.jefatura_actual.docente.usuario.nombre }} {{ curso.jefatura_actual.docente.usuario.apellido_paterno }}
                                    {% else %}
                                        <span class="text-muted">Sin profesor asignado</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-info">{{ curso.total_estudiantes }} estudiantes</span>
                                </td>
                                <td>
                                    <span class="badge bg-success">Activo</span>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center">No hay cursos registrados</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Asignaturas -->
            <div class="container-fluid">
                <h5 class="mb-3">Asignaturas y Horarios</h5>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Código</th>
                                <th>Nombre</th>
                                <th>Curso</th>
                                <th>Profesor</th>
                                <th>Día</th>
                                <th>Horario</th>
                                <th>Sala</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for asignatura in asignaturas %}
                                {% for clase in asignatura.clases.all %}
                                <tr>
                                    <td><span class="badge bg-secondary">{{ asignatura.codigo }}</span></td>
                                    <td>{{ asignatura.asignatura.nombre }}</td>
                                    <td>
                                        {% if clase.curso %}
                                            <span class="badge bg-primary">{{ clase.curso.nivel }}°{{ clase.curso.letra }}</span>
                                        {% else %}
                                            <span class="badge bg-warning">Electivo</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if asignatura.docente %}
                                            {{ asignatura.docente.usuario.nombre }} {{ asignatura.docente.usuario.apellido_paterno }}
                                        {% else %}
                                            <span class="text-danger">Sin profesor</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="badge bg-info">{{ clase.get_fecha_display }}</span>
                                    </td>
                                    <td>
                                        {% if clase.horario == '1' %}
                                            <span class="badge bg-success">08:00 - 08:45</span>
                                        {% elif clase.horario == '2' %}
                                            <span class="badge bg-success">08:45 - 09:30</span>
                                        {% elif clase.horario == '3' %}
                                            <span class="badge bg-success">09:45 - 10:30</span>
                                        {% elif clase.horario == '4' %}
                                            <span class="badge bg-success">10:30 - 11:15</span>
                                        {% elif clase.horario == '5' %}
                                            <span class="badge bg-success">11:30 - 12:15</span>
                                        {% elif clase.horario == '6' %}
                                            <span class="badge bg-success">12:15 - 13:00</span>
                                        {% elif clase.horario == '7' %}
                                            <span class="badge bg-success">13:45 - 14:30</span>
                                        {% elif clase.horario == '8' %}
                                            <span class="badge bg-success">14:30 - 15:15</span>
                                        {% elif clase.horario == '9' %}
                                            <span class="badge bg-success">15:15 - 16:00</span>
                                        {% elif clase.horario == 'RECREO1' %}
                                            <span class="badge bg-warning">09:30 - 09:45 (Recreo)</span>
                                        {% elif clase.horario == 'RECREO2' %}
                                            <span class="badge bg-warning">11:15 - 11:30 (Recreo)</span>
                                        {% elif clase.horario == 'ALMUERZO' %}
                                            <span class="badge bg-warning">13:00 - 13:45 (Almuerzo)</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if clase.sala == 'GIMNASIO' %}
                                            <span class="badge bg-warning">{{ clase.get_sala_display }}</span>
                                        {% elif 'LAB_' in clase.sala %}
                                            <span class="badge bg-info">{{ clase.get_sala_display }}</span>
                                        {% elif clase.sala == 'SALA_9' or clase.sala == 'SALA_10' %}
                                            <span class="badge bg-secondary">{{ clase.get_sala_display }} (Electivos)</span>
                                        {% else %}
                                            <span class="badge bg-primary">{{ clase.get_sala_display }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if clase.fecha == 'VIERNES' and clase.horario > '6' %}
                                            <span class="badge bg-danger">Horario no válido</span>
                                        {% else %}
                                            <span class="badge bg-success">Activo</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            {% empty %}
                            <tr>
                                <td colspan="8" class="text-center">No hay asignaturas registradas</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Modal de Edición de Usuario -->
            <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="editUserModalLabel">Editar Usuario</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="editUserForm">
                                <input type="hidden" id="edit-user-id" name="user_id">
                                <div class="mb-3">
                                    <label for="edit-nombre" class="form-label">Nombre</label>
                                    <input type="text" class="form-control" id="edit-nombre" name="nombre" required>
                                </div>
                                <div class="mb-3">
                                    <label for="edit-apellido-paterno" class="form-label">Apellido Paterno</label>
                                    <input type="text" class="form-control" id="edit-apellido-paterno" name="apellido_paterno" required>
                                </div>
                                <div class="mb-3">
                                    <label for="edit-apellido-materno" class="form-label">Apellido Materno</label>
                                    <input type="text" class="form-control" id="edit-apellido-materno" name="apellido_materno" required>
                                </div>
                                <div class="mb-3">
                                    <label for="edit-rut" class="form-label">RUT</label>
                                    <input type="text" class="form-control" id="edit-rut" name="rut" required>
                                </div>
                                <div class="mb-3">
                                    <label for="edit-div" class="form-label">Dígito Verificador</label>
                                    <input type="text" class="form-control" id="edit-div" name="div" required>
                                </div>
                                <div class="mb-3">
                                    <label for="edit-correo" class="form-label">Correo</label>
                                    <input type="email" class="form-control" id="edit-correo" name="correo" required>
                                </div>
                                <div class="mb-3">
                                    <label for="edit-telefono" class="form-label">Teléfono</label>
                                    <input type="text" class="form-control" id="edit-telefono" name="telefono" required>
                                </div>
                                <div class="mb-3">
                                    <label for="edit-direccion" class="form-label">Dirección</label>
                                    <textarea class="form-control" id="edit-direccion" name="direccion" rows="2" required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="edit-fecha-nacimiento" class="form-label">Fecha de Nacimiento</label>
                                    <input type="date" class="form-control" id="edit-fecha-nacimiento" name="fecha_nacimiento" required>
                                </div>
                                <div class="mb-3">
                                    <label for="edit-tipo-usuario" class="form-label">Tipo de Usuario</label>
                                    <select class="form-select" id="edit-tipo-usuario" name="tipo_usuario" required>
                                        <option value="">Seleccione un tipo</option>
                                        <option value="estudiante">Estudiante</option>
                                        <option value="docente">Docente</option>
                                        <option value="administrativo">Administrador</option>
                                    </select>
                                </div>
                                <!-- Campos específicos para estudiantes -->
                                <div class="estudiante-fields" style="display: none;">
                                    <div class="mb-3">
                                        <label for="edit-contacto-emergencia" class="form-label">Contacto de Emergencia</label>
                                        <input type="text" class="form-control" id="edit-contacto-emergencia" name="contacto_emergencia">
                                    </div>
                                    <div class="mb-3">
                                        <label for="edit-curso" class="form-label">Curso</label>
                                        <select class="form-select" id="edit-curso" name="curso">
                                            <option value="">Seleccione un curso</option>
                                            {% for curso in cursos %}
                                                <option value="{{ curso.id }}">{{ curso.nivel }}°{{ curso.letra }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <!-- Campos específicos para docentes -->
                                <div class="docente-fields" style="display: none;">
                                    <div class="mb-3">
                                        <label for="edit-especialidad" class="form-label">Especialidad</label>
                                        <select class="form-select" id="edit-especialidad" name="especialidad">
                                            <option value="">Seleccione una especialidad</option>
                                            {% for especialidad in especialidades %}
                                                <option value="{{ especialidad.id }}">{{ especialidad.nombre }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input type="checkbox" class="form-check-input" id="edit-es-profesor-jefe" name="es_profesor_jefe">
                                            <label class="form-check-label" for="edit-es-profesor-jefe">Es Profesor Jefe</label>
                                        </div>
                                    </div>
                                </div>
                                <!-- Campos específicos para administrativos -->
                                <div class="administrativo-fields" style="display: none;">
                                    <div class="mb-3">
                                        <label for="edit-rol-administrativo" class="form-label">Rol Administrativo</label>
                                        <select class="form-select" id="edit-rol-administrativo" name="rol_administrativo">
                                            <option value="">Seleccione un rol</option>
                                            <option value="secretaria">Secretaría</option>
                                            <option value="coordinador">Coordinador</option>
                                            <option value="director">Director</option>
                                        </select>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" form="editUserForm" class="btn btn-primary">Guardar Cambios</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal de Detalles de Usuario -->
            <div class="modal fade" id="userDetailsModal" tabindex="-1" aria-labelledby="userDetailsModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="userDetailsModalLabel">Detalles del Usuario</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="mb-3">Información Personal</h6>
                                    <p><strong>Nombre Completo:</strong> <span id="detail-nombre-completo"></span></p>
                                    <p><strong>RUT:</strong> <span id="detail-rut"></span></p>
                                    <p><strong>Correo:</strong> <span id="detail-correo"></span></p>
                                    <p><strong>Teléfono:</strong> <span id="detail-telefono"></span></p>
                                    <p><strong>Dirección:</strong> <span id="detail-direccion"></span></p>
                                    <p><strong>Fecha de Nacimiento:</strong> <span id="detail-fecha-nacimiento"></span></p>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="mb-3">Información del Sistema</h6>
                                    <p><strong>Tipo de Usuario:</strong> <span id="detail-tipo-usuario"></span></p>
                                    <p><strong>Estado:</strong> <span id="detail-estado" class="badge"></span></p>
                                    <p><strong>Fecha de Creación:</strong> <span id="detail-fecha-creacion"></span></p>
                                    
                                    <!-- Información específica de Estudiante -->
                                    <div id="detail-estudiante-info" style="display: none;">
                                        <h6 class="mt-4 mb-3">Información de Estudiante</h6>
                                        <p><strong>Contacto de Emergencia:</strong> <span id="detail-contacto-emergencia"></span></p>
                                        <p><strong>Curso:</strong> <span id="detail-curso"></span></p>
                                    </div>
                                    
                                    <!-- Información específica de Docente -->
                                    <div id="detail-docente-info" style="display: none;">
                                        <h6 class="mt-4 mb-3">Información de Docente</h6>
                                        <p><strong>Especialidad:</strong> <span id="detail-especialidad"></span></p>
                                        <p><strong>Profesor Jefe:</strong> <span id="detail-es-profesor-jefe"></span></p>
                                    </div>
                                    
                                    <!-- Información específica de Administrativo -->
                                    <div id="detail-administrativo-info" style="display: none;">
                                        <h6 class="mt-4 mb-3">Información de Administrativo</h6>
                                        <p><strong>Rol:</strong> <span id="detail-rol-administrativo"></span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </main>
    </div>
</div>
{% else %}
<div class="container mt-5">
    <div class="alert alert-warning">
        <h4 class="alert-heading">Acceso Denegado</h4>
        <p>Debes iniciar sesión para acceder a esta página.</p>
        <hr>
        <p class="mb-0">
            <a href="{% url 'login' %}" class="btn btn-primary">Iniciar Sesión</a>
        </p>
    </div>
</div>
{% endif %}
{% endblock %}